{"ast":null,"code":"import axios from 'axios';\n\n// Lấy URL từ biến môi trường hoặc mặc định localhost\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\n// 1. Khởi tạo Axios Instance\nconst api = axios.create({\n  baseURL: API_BASE,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// 2. Interceptor: Tự động gắn Token vào mọi request nếu đã đăng nhập\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token'); // Lấy token từ LocalStorage\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n  }\n  return config;\n}, error => Promise.reject(error));\n\n// 3. Interceptor: Xử lý lỗi trả về\napi.interceptors.response.use(response => response.data,\n// Trả về data trực tiếp cho gọn\nerror => {\n  // Xử lý lỗi 401 (Hết hạn token hoặc chưa đăng nhập)\n  if (error.response && error.response.status === 401) {\n    // Chỉ logout nếu không phải đang ở trang login (tránh lặp vô tận)\n    if (window.location.pathname !== '/login') {\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n      // Có thể redirect về login hoặc reload trang\n      // window.location.href = '/login'; \n    }\n  }\n  // Trả về lỗi để component xử lý hiển thị alert\n  return Promise.reject(error.response ? error.response.data : error);\n});\n\n// --- ĐỊNH NGHĨA CÁC API ENDPOINTS (Khớp với Backend Routes) ---\n\nexport const ProductAPI = {\n  // Lấy danh sách sản phẩm (hỗ trợ lọc, tìm kiếm, phân trang)\n  // Backend: GET /products?page=1&limit=20&search=...\n  getAll: params => api.get('/products', {\n    params\n  }),\n  // Lấy chi tiết sản phẩm (theo ID hoặc Slug)\n  // Backend: GET /products/:idOrSlug\n  getDetail: idOrSlug => api.get(`/products/${idOrSlug}`),\n  // Lấy dữ liệu cho trang chủ (Mới, Bán chạy, Category)\n  // Backend: GET /products/home/sections\n  getHomeSections: () => api.get('/products/home/sections'),\n  // Lấy bình luận\n  getReviews: (idOrSlug, params) => api.get(`/products/${idOrSlug}/reviews`, {\n    params\n  }),\n  addReview: (idOrSlug, data) => api.post(`/products/${idOrSlug}/reviews`, data)\n};\nexport const AuthAPI = {\n  // Backend: POST /users/login\n  login: data => api.post('/users/login', data),\n  // Backend: POST /users/register\n  register: data => api.post('/users/register', data),\n  // Backend: GET /users/profile\n  getProfile: () => api.get('/users/profile'),\n  // Backend: PUT /users/profile\n  updateProfile: data => api.put('/users/profile', data),\n  // Backend: PUT /users/change-password\n  changePassword: data => api.put('/users/change-password', data),\n  // Backend: POST /users/logout\n  logout: () => api.post('/users/logout')\n};\nexport const OrderAPI = {\n  // --- GIỎ HÀNG ---\n  // Backend: POST /orders/cart (Thêm vào giỏ)\n  addToCart: data => api.post('/orders/cart', data),\n  // Backend: GET /orders/cart (Xem giỏ)\n  getCart: () => api.get('/orders/cart'),\n  // Backend: PUT /orders/cart/:itemId (Sửa số lượng)\n  updateCartItem: (itemId, quantity) => api.put(`/orders/cart/${itemId}`, {\n    quantity\n  }),\n  // Backend: DELETE /orders/cart/:itemId (Xóa item)\n  removeCartItem: itemId => api.delete(`/orders/cart/${itemId}`),\n  // --- THANH TOÁN & ĐƠN HÀNG ---\n  // Backend: POST /orders/cart-discount (Áp mã giảm giá)\n  applyCoupon: code => api.post('/orders/cart-discount', {\n    code\n  }),\n  // Backend: POST /orders/checkout (Đặt hàng)\n  checkout: data => api.post('/orders/checkout', data),\n  // Backend: GET /orders/history (Lịch sử đơn hàng)\n  getHistory: () => api.get('/orders/history'),\n  // Backend: GET /orders/:orderId (Chi tiết đơn hàng)\n  getDetail: orderId => api.get(`/orders/${orderId}`)\n};\n\n// Admin API (Sẽ bổ sung sau nếu cần)\nexport const AdminAPI = {\n  getDashboard: () => api.get('/admin/dashboard/basic'),\n  getCharts: params => api.get('/admin/dashboard/charts', {\n    params\n  }),\n  // Quản lý Users\n  getUsers: () => api.get('/admin/users'),\n  blockUser: id => api.put(`/admin/users/${id}/block`),\n  unblockUser: id => api.put(`/admin/users/${id}/unblock`),\n  // Quản lý Products\n  addProduct: data => api.post('/admin/products', data),\n  updateProduct: (id, data) => api.put(`/admin/products/${id}`, data),\n  deleteProduct: id => api.delete(`/admin/products/${id}`),\n  // Quản lý Orders\n  getOrders: params => api.get('/admin/orders', {\n    params\n  }),\n  updateOrderStatus: (id, status) => api.put(`/admin/orders/${id}/status`, {\n    status\n  })\n};\nexport default api;","map":{"version":3,"names":["axios","API_BASE","process","env","REACT_APP_API_URL","api","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","error","Promise","reject","response","data","status","window","location","pathname","removeItem","ProductAPI","getAll","params","get","getDetail","idOrSlug","getHomeSections","getReviews","addReview","post","AuthAPI","login","register","getProfile","updateProfile","put","changePassword","logout","OrderAPI","addToCart","getCart","updateCartItem","itemId","quantity","removeCartItem","delete","applyCoupon","code","checkout","getHistory","orderId","AdminAPI","getDashboard","getCharts","getUsers","blockUser","id","unblockUser","addProduct","updateProduct","deleteProduct","getOrders","updateOrderStatus"],"sources":["D:/52200147/HKVII/NodeJS/CK/ecommerce_project_NodeJS_final/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\n\r\n// Lấy URL từ biến môi trường hoặc mặc định localhost\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\n// 1. Khởi tạo Axios Instance\r\nconst api = axios.create({\r\n    baseURL: API_BASE,\r\n    headers: {\r\n        'Content-Type': 'application/json',\r\n    },\r\n});\r\n\r\n// 2. Interceptor: Tự động gắn Token vào mọi request nếu đã đăng nhập\r\napi.interceptors.request.use(\r\n    (config) => {\r\n        const token = localStorage.getItem('token'); // Lấy token từ LocalStorage\r\n        if (token) {\r\n            config.headers['Authorization'] = `Bearer ${token}`;\r\n        }\r\n        return config;\r\n    },\r\n    (error) => Promise.reject(error)\r\n);\r\n\r\n// 3. Interceptor: Xử lý lỗi trả về\r\napi.interceptors.response.use(\r\n    (response) => response.data, // Trả về data trực tiếp cho gọn\r\n    (error) => {\r\n        // Xử lý lỗi 401 (Hết hạn token hoặc chưa đăng nhập)\r\n        if (error.response && error.response.status === 401) {\r\n            // Chỉ logout nếu không phải đang ở trang login (tránh lặp vô tận)\r\n            if (window.location.pathname !== '/login') {\r\n                localStorage.removeItem('token');\r\n                localStorage.removeItem('userInfo');\r\n                // Có thể redirect về login hoặc reload trang\r\n                // window.location.href = '/login'; \r\n            }\r\n        }\r\n        // Trả về lỗi để component xử lý hiển thị alert\r\n        return Promise.reject(error.response ? error.response.data : error);\r\n    }\r\n);\r\n\r\n// --- ĐỊNH NGHĨA CÁC API ENDPOINTS (Khớp với Backend Routes) ---\r\n\r\nexport const ProductAPI = {\r\n    // Lấy danh sách sản phẩm (hỗ trợ lọc, tìm kiếm, phân trang)\r\n    // Backend: GET /products?page=1&limit=20&search=...\r\n    getAll: (params) => api.get('/products', { params }),\r\n\r\n    // Lấy chi tiết sản phẩm (theo ID hoặc Slug)\r\n    // Backend: GET /products/:idOrSlug\r\n    getDetail: (idOrSlug) => api.get(`/products/${idOrSlug}`),\r\n\r\n    // Lấy dữ liệu cho trang chủ (Mới, Bán chạy, Category)\r\n    // Backend: GET /products/home/sections\r\n    getHomeSections: () => api.get('/products/home/sections'),\r\n\r\n    // Lấy bình luận\r\n    getReviews: (idOrSlug, params) => api.get(`/products/${idOrSlug}/reviews`, { params }),\r\n    addReview: (idOrSlug, data) => api.post(`/products/${idOrSlug}/reviews`, data),\r\n};\r\n\r\nexport const AuthAPI = {\r\n    // Backend: POST /users/login\r\n    login: (data) => api.post('/users/login', data),\r\n\r\n    // Backend: POST /users/register\r\n    register: (data) => api.post('/users/register', data),\r\n\r\n    // Backend: GET /users/profile\r\n    getProfile: () => api.get('/users/profile'),\r\n\r\n    // Backend: PUT /users/profile\r\n    updateProfile: (data) => api.put('/users/profile', data),\r\n\r\n    // Backend: PUT /users/change-password\r\n    changePassword: (data) => api.put('/users/change-password', data),\r\n\r\n    // Backend: POST /users/logout\r\n    logout: () => api.post('/users/logout'),\r\n};\r\n\r\nexport const OrderAPI = {\r\n    // --- GIỎ HÀNG ---\r\n    // Backend: POST /orders/cart (Thêm vào giỏ)\r\n    addToCart: (data) => api.post('/orders/cart', data),\r\n\r\n    // Backend: GET /orders/cart (Xem giỏ)\r\n    getCart: () => api.get('/orders/cart'),\r\n\r\n    // Backend: PUT /orders/cart/:itemId (Sửa số lượng)\r\n    updateCartItem: (itemId, quantity) => api.put(`/orders/cart/${itemId}`, { quantity }),\r\n\r\n    // Backend: DELETE /orders/cart/:itemId (Xóa item)\r\n    removeCartItem: (itemId) => api.delete(`/orders/cart/${itemId}`),\r\n\r\n    // --- THANH TOÁN & ĐƠN HÀNG ---\r\n    // Backend: POST /orders/cart-discount (Áp mã giảm giá)\r\n    applyCoupon: (code) => api.post('/orders/cart-discount', { code }),\r\n\r\n    // Backend: POST /orders/checkout (Đặt hàng)\r\n    checkout: (data) => api.post('/orders/checkout', data),\r\n\r\n    // Backend: GET /orders/history (Lịch sử đơn hàng)\r\n    getHistory: () => api.get('/orders/history'),\r\n\r\n    // Backend: GET /orders/:orderId (Chi tiết đơn hàng)\r\n    getDetail: (orderId) => api.get(`/orders/${orderId}`),\r\n};\r\n\r\n// Admin API (Sẽ bổ sung sau nếu cần)\r\nexport const AdminAPI = {\r\n    getDashboard: () => api.get('/admin/dashboard/basic'),\r\n    getCharts: (params) => api.get('/admin/dashboard/charts', { params }),\r\n    // Quản lý Users\r\n    getUsers: () => api.get('/admin/users'),\r\n    blockUser: (id) => api.put(`/admin/users/${id}/block`),\r\n    unblockUser: (id) => api.put(`/admin/users/${id}/unblock`),\r\n\r\n    // Quản lý Products\r\n    addProduct: (data) => api.post('/admin/products', data),\r\n    updateProduct: (id, data) => api.put(`/admin/products/${id}`, data),\r\n    deleteProduct: (id) => api.delete(`/admin/products/${id}`),\r\n\r\n    // Quản lý Orders\r\n    getOrders: (params) => api.get('/admin/orders', { params }),\r\n    updateOrderStatus: (id, status) => api.put(`/admin/orders/${id}/status`, { status }),\r\n};\r\n\r\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}